## âœ…Â ì‚­ì œ ê¸°ëŠ¥ ë§Œë“¤ê¸°

> ê¸€ ì‚­ì œê¸°ëŠ¥ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œ ì•„ë˜ì™€ ê°™ì´ ì ‘ê·¼í•´ë³´ì•˜ë‹¤.

```tsx
1. ë¨¼ì € ì‚­ì œí•  ê¸€ì˜ idê°’ì„ ì•Œì•„ì•¼ í•˜ë©°, í•´ë‹¹ ê¸€ì„ í´ë¦­í–ˆì„ ë•Œ ì‚­ì œ ìš”ì²­ì— idê°’ë„ ê°™ì´ ë³´ë‚´ì£¼ì–´ì•¼ í•œë‹¤.

2. 1ë²ˆì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì‚­ì œìš”ì²­ì„ ìœ„í•œ ê²½ë¡œë¥¼ /api/post/delete ë¡œ ì„¤ì •í•´ì£¼ì—ˆìœ¼ë©°
   1ë²ˆ ê³¼ì •ì—ì„œ fetchì•ˆì— bodyì— JSON.stringify(info._id)ë¥¼ ì ì–´ì£¼ì–´ idê°’ë„ ë³´ë‚´ì£¼ì—ˆë‹¤.

3. ë§ˆì§€ë§‰ìœ¼ë¡œëŠ” ì‚­ì œìš”ì²­ ì²˜ë¦¬ ë¶€ë¶„ì—ì„œ idê°’ì´ ì¡´ì¬í•˜ëŠ” ì§€ í™•ì¸í•˜ê³ ,
   3-1. idê°’ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ëŠ” DBëª©ë¡ì„ ì°¸ê³ í•˜ì—¬ í•´ë‹¹ idê°’ ê¸€ ëª©ë¡ì˜ idê°’ì„ ë¹„êµí•˜ì—¬ ì¼ì¹˜í•˜ëŠ” ê¸€ì„ ì‚­ì œ
   3-2. idê°’ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” ì—ëŸ¬ë¥¼ ë°˜í™˜
```

ìœ„ ê³¼ì •ì„ ì½”ë“œë¥¼ í†µí•´ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤

`ListItem ì»´í¬ë„ŒíŠ¸`

```tsx
<span
  className="cursor-pointer"
  onClick={() => {
    fetch(`/api/post/delete`, {
      method: 'POST',
      body: JSON.stringify(info._id),
    }).then(() => {
      console.log('ì‚­ì œ ì™„ë£Œ');
    });
  }}
>
  ğŸ—‘ï¸
</span>
```

> ìœ„ì™€ ê°™ì´ `onClickí•¨ìˆ˜`ë¥¼ í†µí•´ í•´ë‹¹ ì•„ì´ì½˜ í´ë¦­ì‹œ ì‚­ì œìš”ì²­ì„ ë³´ë‚´ì£¼ì—ˆìœ¼ë©°
> ì´ë•Œ bodyì— `idê°’`ë„ í•¨ê»˜ ë„£ì–´ì£¼ì—ˆë‹¤.

`/api/post/delete (ì‚­ì œ ìš”ì²­ url)`

```tsx
import { connectDB } from '@/utils/database';
import { ObjectId } from 'mongodb';
import { redirect } from 'next/navigation';

export async function POST(request: Request) {
  const id = await request.json();

  if (!id) {
    return new Response('idê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!', {
      status: 500,
    });
  }

  try {
    const client = await connectDB;
    const db = client.db('forum');
    await db.collection('post').deleteOne({ _id: new ObjectId(id + '') });

    redirect('/list');
  } catch (error) {
    return new Response('DBì—ëŸ¬', {
      status: 500,
    });
  }
}
```

> ìœ„ì™€ ê°™ì´ `await request.json()` ì„ í†µí•´ ì‚­ì œ ìš”ì²­ì´ ê°™ì´ ë„˜ì–´ì˜¨ idê°’ì„ ë°›ì•„ì˜¨ë‹¤
> í•´ë‹¹ idê°’ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” idê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  ì•Œë ¤ì£¼ë©°,
> í•´ë‹¹ idê°’ì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ëŠ” í•´ë‹¹ DBì•ˆì— collectionì— ìˆëŠ” ê¸€ ëª©ë¡ì¤‘ idê°’ì´ ì¼ì¹˜í•˜ëŠ” ëª©ë¡ì„ ì°¾ì•„
> ì‚­ì œí•œë‹¤

## âœ…Â static & dynamic rendering + cache

![Untitled](next%20%E1%84%91%E1%85%B5%E1%86%AF%E1%84%80%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%BC%2090c1c7e9b66941e69ed92d2ad8ef183c/Untitled.png)

> `O`ëŠ” `static rendering`ì„ ì˜ë¯¸í•˜ë©° í˜ì´ì§€ ì•ˆì— ë³„ë„ì˜ ê¸°ëŠ¥ì´ ì—†ì´ ë§¤ë²ˆ htmlì„ ìƒˆë¡œ ë§Œë“¤ í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ë³´ë‚´ë„ ëœë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

**`Î»` ëŠ” ìœ ì €ê°€ í˜ì´ì§€ ì ‘ì†ì‹œ htmlì— ë³€ë™ì‚¬í•­ì´ ë“¤ì–´ê°€ì•¼í•˜ê¸° ë•Œë¬¸ì— ìœ ì €ê°€ í˜ì´ì§€ì— ë“¤ì–´ê°ˆë•Œë§ˆë‹¤ html í˜ì´ì§€ë¥¼ ì„œë²„ì—ì„œ ë‹¤ì‹œ ê·¸ë ¤ì¤€ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.**

>

ê·¸ì¹˜ë§Œ `/list í˜ì´ì§€`ì˜ ê²½ìš° ê¸€ì‘ì„±ì„ í•˜ê³  ì‚­ì œí•˜ë©´ í•´ë‹¹ í˜ì´ì§€ì— ì¦‰ê°ì ìœ¼ë¡œ ë°˜ì˜ë˜ì–´ì•¼í•˜ëŠ” dynamicí˜ì´ì§€ì¸ë° `O` í‘œì‹œì¸ static renderingìœ¼ë¡œ í‘œì‹œëœë‹¤.

```tsx
export const dynamic = 'force-dynamic';
```

> í•´ë‹¹ ì½”ë“œë¥¼ dynamic renderingì„ í•˜ê³  ì‹¶ì€ í˜ì´ì§€ì˜ ìƒë‹¨ì— ì¶”ê°€í•˜ë©´ í•´ë‹¹ í˜ì´ì§€ê°€ dynamic renderingëœë‹¤.

`BUT`, dynamic renderingì„ ë§ì´ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì„œë²„/DBë¶€ë‹´ì´ ì‹¬í•´ì§„ë‹¤ (ë‹¨ì )

â†’ ìœ ì €ê°€ í•´ë‹¹ í˜ì´ì§€ë¥¼ ë°©ë¬¸í• ë•Œë§ˆë‹¤ ì„œë²„ì—ì„œëŠ” ê³„ì†í•´ì„œ í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ì•¼í•˜ê¸° ë•Œë¬¸

## âœ…Â ìºì‹± ê¸°ëŠ¥

> ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ë•Œ fetchë¥¼ í†µí•´ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê²Œ ë˜ëŠ”ë° ì´ë•Œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ìºì‹±í•  ìˆ˜ ìˆë‹¤!

```tsx
// 'force-cache' is the default, and can be omitted
fetch('https://...', { cache: 'force-cache' });
```

![Untitled](next%20%E1%84%91%E1%85%B5%E1%86%AF%E1%84%80%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%BC%2090c1c7e9b66941e69ed92d2ad8ef183c/Untitled%201.png)

ê³µì‹ë¬¸ì„œë¥¼ ë³´ë©´ ìœ„ì™€ ê°™ì´ fetchë¥¼ í†µí•´ ì–»ì€ dataëŠ” ìë™ìœ¼ë¡œ ìºì‹œë˜ì–´ ì €ì¥ëœë‹¤ê³  í•œë‹¤â€¦
(ë¦¬ì•¡íŠ¸ì¿¼ë¦¬ì™€ ë¹„ìŠ·í•œê²ƒ ê°™ë‹¤â€¦ğŸ˜‚ğŸ˜‚ğŸ˜‚)

ë˜í•œ ìºì‹œëœ ë°ì´í„°ë¥¼ ì¬ê²€ì¦í•˜ëŠ”ë°ì—ëŠ” 2ê°€ì§€ ì „ëµì´ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ”ë° ì´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤!

![Untitled](next%20%E1%84%91%E1%85%B5%E1%86%AF%E1%84%80%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%BC%2090c1c7e9b66941e69ed92d2ad8ef183c/Untitled%202.png)

> 1ï¸âƒ£Â ì²«ë²ˆì§¸ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ë•Œ ë¯¸ë¦¬ ì¼ì •ì‹œê°„ì„ ì •í•´ë‘ê³  ì¬ê²€ì¦í•´ì£¼ëŠ” ë°©ë²•
> `fetch('https://...', { next: { revalidate: 3600 } })`

- ë§Œì•½ ìœ„ì™€ ê°™ì´ ì¼ì •ì‹œê°„ì„ ì •í•œ ë°ì´í„°ê°€ ë§ê³  ê°ê°ì˜ ë°ì´í„°ë§ˆë‹¤ ì‹œê°„ì´ ë‹¤ë¥´ë‹¤ë©´
  ê°€ì¥ ì‘ì€ ì‹œê°„ì„ ê°€ì§„ ë°ì´í„°ì˜ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ë°ì´í„°ê°€ ì¬ê²€ì¦ëœë‹¤!
  >

> 2ï¸âƒ£Â ì½”ë“œë¥¼ í†µí•´ ì§ì ‘ ì¬ê²€ì¦í•´ì£¼ëŠ” ë°©ë²•
>
> export default async function Page() {
> const res = await fetch('https://...', { next: { tags: ['collection'] } })
> const data = await res.json()
> // ...
> }
>
> ìœ„ì™€ ê°™ì´ `collection` ì´ë¼ëŠ” tagë¥¼ ë¶™ì—¬ì£¼ê³ 
>
> 'use server'
>
> import { revalidateTag } from 'next/cache'
>
> export default async function action() {
> revalidateTag('collection')
> }
>
> actioní•¨ìˆ˜ë‚´ì—ì„œ revalidateTag('collection')ì„ í†µí•´ ì§ì ‘ ì¬ê²€ì¦ì„ ì§„í–‰í•´ì¤„ ìˆ˜ë„ ìˆë‹¤!

## âœ…Â íšŒì› ê¸°ëŠ¥ (Next-auth)

> next-authì—ì„œëŠ” ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
> next-authì—ì„œëŠ” providerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ì„ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë©°

1. ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ëŠ” `credentials ë°©ì‹` ,
2. êµ¬ê¸€, ë„¤ì´ë²„, ì¹´ì¹´ì˜¤ providerë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ í•˜ëŠ” ë°©ì‹ì´ ìˆë‹¤.
   >

> `STEP 1`

```tsx
import NextAuth from 'next-auth';
import GithubProvider from 'next-auth/providers/github';

export const authOptions = {
  // Configure one or more authentication providers
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET,
    }),
    // ...add more providers here
  ],
};

export default NextAuth(authOptions);
```

`pages/api/auth/[â€¦nextauth].js` íŒŒì¼ì„ ìœ„ì™€ ê°™ì´ ì´ˆê¸°í™” í•  ìˆ˜ ìˆë‹¤.
authOptionsì•ˆì—ëŠ” providersê°€ ìˆìœ¼ë©° ì›í•˜ëŠ” ì†Œì…œ ë¡œê·¸ì¸ì˜ providerë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤â€¦

ì†Œì…œ ë¡œê·¸ì¸ì´ ì¢€ í¸í•´ì§„ê²ƒ ê°™ë‹¤..! ì¹´ì¹´ì˜¤, ë„¤ì´ë²„, êµ¬ê¸€ ë¡œê·¸ì¸ë„ í•œë²ˆ í•´ë´ì•¼ê² ë‹¤..

ì¶”ê°€ë¡œ! app ë¼ìš°í„° ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•˜ê³  ì‹¶ë‹¤ë©´ app/api/auth/[â€¦nextauth]/route.ts ì˜ íŒŒì¼ì— ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¡œ ì ì–´ì£¼ë©´ ëœë‹¤! (ë™ì¼í•˜ê²Œ ë™ì‘í•¨)

```tsx
import NextAuth from 'next-auth/next';

const handler = NextAuth({});

export { handler as GET, handler as POST };
```

> `STEP 2`

```tsx
'use client';

import { signIn } from 'next-auth/react';

export default async function SocialLoginButton() {
  return <button onClick={() => signIn()}>ë¡œê·¸ì¸</button>;
}
```

ê·¸ í›„ ë¡œê·¸ì¸ì„ ìœ„í•œ ë²„íŠ¼ì„ ë§Œë“  í›„ next-auth/react ì—ì„œ ì œê³µí•˜ëŠ” signIní•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ë!

ì¶”ê°€ë¡œ ë¡œê·¸ì•„ì›ƒì„ ìœ„í•´ì„œëŠ” signOutì„ í˜¸ì¶œí•˜ë©´ ëœë‹¤â€¦ (ì†Œì…œë¡œê·¸ì¸ ë¡œì§ì´ êµ‰ì¥íˆ ê°„ë‹¨í•´ ì§„ê²ƒ ê°™ë‹¤â€¦)

âœš ì¶”ê°€ë¡œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ sessionì„ ê°€ì ¸ì™€ ì£¼ë©´ ëœë‹¤.

(session ì•ˆì—ëŠ” name, email, image ê°€ ì¡´ì¬í•œë‹¤)

```tsx
let session = await getServerSession(authOptions);
```

## âœ…Â ì‚­ì œ + ìˆ˜ì • ê¸°ëŠ¥

> í•´ë‹¹ ê¸€ì„ ì‚¬ìš©ìê°€ ì•„ë‹ˆë©´ ìˆ˜ì •ë²„íŠ¼, ì‚­ì œë²„íŠ¼ì´ ë³´ì´ì§€ ì•Šë„ë¡ ìˆ˜ì •í•  í•„ìš”ê°€ ìˆìœ¼ë©°,
> ì‚­ì œ,ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ í•´ë‹¹ ê¸€ì„ ì‘ì„±í•œ ì‚¬ëŒê³¼ í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ë¥¼ í™•ì¸í•˜ì—¬
> ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ í•´ë‹¹ ë¡œì§ì„ ìˆ˜í–‰í•˜ë„ë¡ ìˆ˜ì •í•´ì¤„ í•„ìš”ê°€ ìˆë‹¤.

â˜ï¸Â ê¸€ ì‘ì„±ìì—ê²Œë§Œ ìˆ˜ì •,ì‚­ì œ ë²„íŠ¼ì´ ë³´ì´ë„ë¡ êµ¬í˜„

```tsx
{
  session?.user?.email === author && (
    <div className="flex items-center gap-2">
      <span>
        <Link href={`/edit/${infoId}`}>âœï¸</Link>
      </span>
      <span className="cursor-pointer" onClick={() => handleDelete(infoId)}>
        ğŸ—‘ï¸
      </span>
    </div>
  );
}
```

> sessionì„ í†µí•´ í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°
> ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì´ë©”ì¼ê³¼ ì‘ì„±ìë¥¼ ë¹„êµí•˜ì—¬ ì¼ì¹˜í•˜ë©´ ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ì´ ë³´ì´ë„ë¡ ìˆ˜ì •í•˜ì˜€ë‹¤.

âœŒï¸Â ì‚­ì œ, ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œì—ë„ ê¸€ì‘ì„±ìì™€ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ë™ì¼í•œì§€ í™•ì¸í•˜ë©°, ë™ì¼í•œ ê²½ìš°ì—ë§Œ ì‚­ì œ,ìˆ˜ì •ì„ ìˆ˜í–‰í•˜ë„ë¡ êµ¬í˜„

```tsx
import { authOptions } from '@/pages/api/auth/[...nextauth]';
import { connectDB } from '@/utils/database';
import { ObjectId } from 'mongodb';
import { getServerSession } from 'next-auth';
import { redirect } from 'next/navigation';

export async function POST(request: Request) {
  let session = await getServerSession(authOptions);
  const id = await request.json();

  if (!id) {
    return new Response('idê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!', {
      status: 500,
    });
  }

  try {
    const client = await connectDB;
    const db = client.db('forum');
    await db
      .collection('post')
      .deleteOne({ _id: new ObjectId(id + ''), author: session?.user?.email });

    redirect('/list');
  } catch (error) {
    return new Response('DBì—ëŸ¬', {
      status: 500,
    });
  }
}
```
