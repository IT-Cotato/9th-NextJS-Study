# Dark mode 기능 2

1. 현재 UI의 상태를 cookie에 저장해둠
2. cookie에 따라서 UI가 어떻게 변할지 작성
3. 필요할 때 cookie 변경

쿠키 생성은 서버 API 코드나 Middleware로도 가능!!

mode라는 이름의 쿠키내용 출력해줌!!
let 쿠키값 = ('; '+document.cookie).split(`; mode=`).pop().split(';')[0]

DarkMode.js ⬇️

```javascript
"use client";

import { useEffect } from "react";

export default function DarkMode() {
  useEffect(() => {
    let 쿠키값 = ("; " + document.cookie).split(`; mode=`).pop().split(";")[0];
    if (쿠키값 == "") {
      document.cookie = "mode=light; max-age=" + 3600 * 24 * 400;
    }
  }, []);
  return <span onClick={() => {}}> 🌙 </span>;
}
```

globals.css ⬇️

```css
.dark-mode .navbar {
  background: #222;
}

.dark-mode .navbar a {
  color: white;
}
```

layout.js ⬇️

```javascript
import { Inter } from "next/font/google";
import Link from "next/link";
import "./globals.css";
import LoginBtn from "./LoginBtn";
import LogoutBtn from "./LogoutBtn";
import { authOptions } from "@/pages/api/auth/[...nextauth]";
import { getServerSession } from "next-auth";
import DarkMode from "./DarkMode";
import { cookies } from "next/headers";

const inter = Inter({ subsets: ["latin"] });

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default async function RootLayout({ children }) {
  let session = await getServerSession(authOptions);

  let res = cookies().get("mode");
  console.log(res.value);

  return (
    <html lang="en">
      <body
        className={res != undefined && res.value == "dark" ? "dark-mode" : ""}
      >
        <div className="navbar">
          <Link href="/" className="logo">
            Letthem Forum
          </Link>
          <Link href="/list">List</Link>
          {session ? (
            <span>
              {session.user.name}
              <LogoutBtn />
            </span>
          ) : (
            <LoginBtn />
          )}
          <DarkMode />
        </div>
        {children}
      </body>
    </html>
  );
}
```

DarkMode.js ⬇️

```javascript
"use client";

import { useRouter } from "next/navigation";
import { useEffect } from "react";

export default function DarkMode() {
  let router = useRouter();
  useEffect(() => {
    let 쿠키값 = ("; " + document.cookie).split(`; mode=`).pop().split(";")[0];
    if (쿠키값 == "") {
      document.cookie = "mode=light; max-age=" + 3600 * 24 * 400;
    }
  }, []);
  return (
    <span
      onClick={() => {
        let 쿠키값 = ("; " + document.cookie)
          .split(`; mode=`)
          .pop()
          .split(";")[0];
        if (쿠키값 == "light") {
          document.cookie = "mode=dark; max-age=" + 3600 * 24 * 400;
          router.refresh();
        } else {
          document.cookie = "mode=light; max-age=" + 3600 * 24 * 400;
          router.refresh();
        }
      }}
    >
      {" "}
      🌙{" "}
    </span>
  );
}
```

> 쿠키 바꾼다고 자동 재렌더링 안 됨!
> 새로고침은 router.refresh()

결론 &rarr; 재접속시 유지되게 하려면 DB/localStorage/cookie
