# 회원기능 만들기 : Auth.js 사용한 소셜로그인

### 소셜로그인 - 아이디/비번관리 필요 없음. 코드 짤 것도 없음

## 1. Github 계정 소셜로그인 해보겠다!

> Github 소셜로그인 허락받기 - settings>developer settings>OAuth 등록!

## 2. next-auth 설치

> npm install next-auth@latest

## 3. pages/api/auth/[...nextauth].js 만들기

```javascript
import NextAuth from "next-auth";
import GithubProvider from "next-auth/providers/github";

export const authOptions = {
  providers: [
    GithubProvider({
      clientId: "Github에서 발급받은 ID",
      clientSecret: "Github에서 발급받은 Secret",
    }),
  ],
  secret: "jwt생성시 쓰는 암호",
};

export default NextAuth(authOptions);
```

## 4. layout.js에 로그인 버튼 추가. but, onClick 써야함. client 컴포넌트 만들자..

app/LoginBtn.js 만들어서

```javascript
"use client";

import { signIn, signOut } from "next-auth/react";

export default function LoginBtn() {
  return (
    <button
      onClick={() => {
        signIn();
      }}
    >
      로그인
    </button>
  );
}
```

실행되면 로그인 페이지 자동 이동!! 매우 편리하다 😊
로그아웃은 signOut() !!

## 5. 로그인된 유저 정보 출력

> await getServerSession(authOptions) : 서버 컴포넌트, 서버 기능 안에서 사용 가능

layout.js ⬇️

```javascript
import { Inter } from "next/font/google";
import Link from "next/link";
import "./globals.css";
import LoginBtn from "./LoginBtn";
import { authOptions } from "@/pages/api/auth/[...nextauth]";

const inter = Inter({ subsets: ["latin"] });

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default async function RootLayout({ children }) {
  let session = await getServerSession(authOptions);
  console.log(session);
  return (
    <html lang="en">
      <body>
        <div className="navbar">
          <Link href="/" className="logo">
            Letthem Forum
          </Link>
          <Link href="/list">List</Link>
          <LoginBtn />
        </div>
        {children}
      </body>
    </html>
  );
}
```

---

❓ Q. 현재 로그인된 유저 정보가 있을 경우 상단바에 유저이름 & 로그아웃 버튼 보여주고 유저 정보가 없을 경우 상단바에 로그인 버튼 보여주려면?

💡 hint : JSX 안에서 if 쓰고 싶으면 삼항 연산자 사용하자

```javascript
{
  조건식 ? 조건식 참일 때 실행할 코드 : 거짓일 때 실행할 코드
}
```

😊 A.

```javascript
import { Inter } from "next/font/google";
import Link from "next/link";
import "./globals.css";
import LoginBtn from "./LoginBtn";
import LogoutBtn from "./LogoutBtn";
import { authOptions } from "@/pages/api/auth/[...nextauth]";
import { getServerSession } from "next-auth";

const inter = Inter({ subsets: ["latin"] });

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default async function RootLayout({ children }) {
  let session = await getServerSession(authOptions);

  return (
    <html lang="en">
      <body>
        <div className="navbar">
          <Link href="/" className="logo">
            Letthem Forum
          </Link>
          <Link href="/list">List</Link>
          {session ? (
            <span>
              {session.user.name}
              <LogoutBtn />
            </span>
          ) : (
            <LoginBtn />
          )}
        </div>
        {children}
      </body>
    </html>
  );
}
```
